<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="HN Deck: An alternate way to browse Hacker News">
    <meta name="author" content="Sagun shrestha">
    <title>HN Deck: An alternate way to browse Hacker News</title>

    <meta name="title" content="HN Deck">
    <meta name="description" content="HN Deck: An alternate way to browse Hacker News">
    <meta name="keywords" content="hackernews, ycombinator, hacker news, hackernews api"/>

    <meta property="og:type" content="website">
    <meta property="og:site_name" content="HN Deck">
    <meta property="og:url" content="hndeck.sagunshrestha.com">
    <meta property="og:title" content="HN Deck">
    <meta property="og:description" content="HN Deck: An alternate way to browse Hacker News">
    <meta property="og:image" content="https://hndeck.sagunshrestha.com/static/img/profile.png">

    <meta property="twitter:card" content="summary">
    <meta property="twitter:url" content="hndeck.sagunshrestha.com">
    <meta property="twitter:title" content="HN Deck">
    <meta property="twitter:description" content="HN Deck: An alternate way to browse Hacker News">
    <meta property="twitter:image" content="https://hndeck.sagunshrestha.com/static/img/profile.png">
    <meta property="twitter:image:src" content="https://hndeck.sagunshrestha.com/static/img/profile.png">

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
          integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

    <!--  Custom CSS  -->
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    
    <!-- Theme Detection Script - Runs immediately to prevent flash -->
    <script>
        (function() {
            function detectAndSetTheme() {
                const savedTheme = localStorage.getItem('theme');
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                
                // If no saved preference, use browser preference
                if (!savedTheme || savedTheme === 'auto') {
                    document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
                } else {
                    // Use saved preference
                    document.documentElement.setAttribute('data-theme', savedTheme);
                }
            }
            
            // Set theme immediately
            detectAndSetTheme();
            
            // Listen for system theme changes when in auto mode
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                const savedTheme = localStorage.getItem('theme');
                if (!savedTheme || savedTheme === 'auto') {
                    document.documentElement.setAttribute('data-theme', e.matches ? 'dark' : 'light');
                }
            });
        })();
    </script>

    <!--  Favicons  -->
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='img/apple-touch-icon.png') }}" sizes="180x180">
    <link rel="icon" href="{{ url_for('static', filename='img/favicon-32x32.png') }}" sizes="32x32" type="image/png">
    <link rel="icon" href="{{ url_for('static', filename='img/favicon-16x16.png') }}" sizes="16x16" type="image/png">
    <link rel="icon" href="{{ url_for('static', filename='img/favicon.ico') }}">
</head>
<body>
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
        <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z"/>
        </svg>
        <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 01.818.162z" clip-rule="evenodd"/>
        </svg>
    </button>
    <main role="main">
        <div class="container-fluid">
            <div class="row">
                {% for key, items in stories.items() %}
                    <div class="col">
                        <div class="header">
                            <h1 class="col-header">{{ key }}</h1>
                        </div>
                        <div class="stories">
                            {% for item in items %}
                                <article class="item-wrapper">
                                    <div class="item">
                                        <p class="title">
                                            <a href="{{ item.url or item.hn_url }}" target="_blank">
                                                {% if item.title|length > 70 %}
                                                    {{ item.title[:67] }}...
                                                {% else %}
                                                    {{ item.title }}
                                                {% endif %}
                                            </a>
                                        </p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted text-left">
                                                {{ item.score }} points by <a href="{{ item.user_url }}"
                                                                              target="_blank">{{ item.by }}</a> {{ item.time }}
                                            </small>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted text-left">{{ item.descendants }} comments | <a
                                                    href="{{ item.hn_url }}" target="_blank">discuss</a>
                                                {% if item.domain %}| <a
                                                        href="https://news.ycombinator.com/from?site={{ item.domain }}"
                                                        target="_blank">{{ item.domain }}</a>{% endif %}</small>
                                        </div>
                                    </div>
                                </article>
                            {% endfor %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </main>

    <script>
        (function() {
            const themeToggle = document.getElementById('themeToggle');
            const html = document.documentElement;
            
            function getBrowserPreference() {
                return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            }
            
            function setTheme(theme) {
                if (theme === 'auto') {
                    // Follow browser preference
                    const browserTheme = getBrowserPreference();
                    html.setAttribute('data-theme', browserTheme);
                    localStorage.setItem('theme', 'auto');
                } else {
                    // Use explicit theme
                    html.setAttribute('data-theme', theme);
                    localStorage.setItem('theme', theme);
                }
            }
            
            function getCurrentTheme() {
                return localStorage.getItem('theme') || 'auto';
            }
            
            function toggleTheme() {
                // Get the actual current visual theme
                const currentVisualTheme = html.getAttribute('data-theme');
                const savedTheme = getCurrentTheme();
                
                // Toggle to the opposite of current visual theme
                const nextVisualTheme = currentVisualTheme === 'dark' ? 'light' : 'dark';
                
                // Save the explicit theme choice (not 'auto')
                html.setAttribute('data-theme', nextVisualTheme);
                localStorage.setItem('theme', nextVisualTheme);
            }
            
            // Initialize theme on page load
            const savedTheme = getCurrentTheme();
            setTheme(savedTheme);
            
            // Set up toggle button
            themeToggle.addEventListener('click', toggleTheme);
            
            // Listen for system theme changes when in auto mode
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                const currentTheme = getCurrentTheme();
                if (currentTheme === 'auto') {
                    html.setAttribute('data-theme', e.matches ? 'dark' : 'light');
                }
            });
        })();
    </script>
</body>
</html>

